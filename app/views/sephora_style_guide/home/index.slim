script src='https://unpkg.com/vue'

main.container-fluid#app role='main'
  h1.h1 Sephora Style Guide

  = render 'sephora_style_guide/home/typography'
  = render 'sephora_style_guide/home/colors'
  = render 'sephora_style_guide/home/buttons'
  = render 'sephora_style_guide/home/forms'
  = render 'sephora_style_guide/home/tables'
  = render 'sephora_style_guide/home/grid'
  = render 'sephora_style_guide/home/pagination'
  = render 'sephora_style_guide/home/modals'
  = render 'sephora_style_guide/home/breadcrumbs'
  = render 'sephora_style_guide/home/tabs'
  = render 'sephora_style_guide/home/accordion'
  = render 'sephora_style_guide/home/loaders'
  = render 'sephora_style_guide/home/dropdowns'

  br
  h2.h2 Partials
  = render 'sephora_style_guide/home/product_card'
  = render 'sephora_style_guide/home/video'

javascript:
  var app = new Vue({
    el: '#app',
    data: {
      text: 'The quick brown fox jumps over the lazy dog.',
      fontSize: '18',
      buttonIsDisabled: false,
      buttonText: this.textInitial,
      buttonTextInitial: '',
      buttonTextPending: 'Adding...',
      showProductOneActions: false,
      showProductTwoActions: false,
      showProductThreeActions: false,
      waitlistText: 'Waitlist Me',
      productIsWaitListed: false,
      productOneIsWishListed: false,
      productTwoIsWishListed: false,
      productThreeIsWishListed: false,
      showDiscountPrice: false,
      showNormalPrice: false,
      showPriceRange: true,
      hoverTimeout: null,
      currentSelect: 1,
      dropdownOptionOne: 'Select',
      dropdownOptionTwo: 'Select',
      searchInput: ''
    },
    methods: {
      changeInitialText: function() {
        this.buttonText = this.buttonTextInitial;
      },

      clickButton: function() {
        var self = this;
        this.buttonText = this.buttonTextPending;
        this.isDisabled = 'disabled';
        setTimeout(function(){
          self.buttonText = self.buttonTextInitial;
          self.buttonIsDisabled = false;
        }, 2000);
      },

      mouseoverProductCard: function(e) {
        const target = e.target.closest('.product-card').getAttribute('name');
        if (target === 'product1') {
          this.showProductOneActions = true;
        } else if (target === 'product2') {
          this.showProductTwoActions = true;
        } else if (target === 'product3') {
          this.showProductThreeActions = true;
        }
      },

      mouseleaveProductCard: function() {
        this.showProductOneActions = false;
        this.showProductTwoActions = false;
        this.showProductThreeActions = false;
      },

      waitlistProduct: function() {
        this.waitlistText = 'Waitlisted';
        this.productIsWaitListed = true;
      },

      setProductRating: function() {
        const product = document.getElementsByName("product3")[0];
        const productRating = product.querySelector(".rateit-selected");
        productRating.style.width = '51px';
      },

      selectVariant: function(e) {
        if ($(e.target).hasClass('product-variant')) {
        
          if (e.target.closest('.product-card').getAttribute('name') === 'product3') {
            this.showPriceRange = false;
            
            if (e.target.parentNode.getAttribute('name') === 'variant14') {
              this.showDiscountPrice = true;
              this.showNormalPrice = false;
            } else if (e.target.parentNode.getAttribute('name') === 'variant15') {
              this.showDiscountPrice = false;
              this.showNormalPrice = true;
            }
          }
          
          const variants = $(e.target).closest('.product-card-variants').children()

          $.each(variants, function(i, variant) {
            $(variant).children().removeClass('active')
          })

          $(e.target).addClass('active')
        }
      },
      
      hoverVariant: function(e) {
        if(this.hoverTimeout) {
          clearTimeout(this.hoverTimeout)
        }
        
        if ($(e.target).hasClass('product-variant')) {
          if (e.target.parentNode.getAttribute('name') === 'variant14') {
            this.showDiscountPrice = true;
            this.showNormalPrice = false;
          } else if (e.target.parentNode.getAttribute('name') === 'variant15') {
            this.showDiscountPrice = false;
            this.showNormalPrice = true;
          }
        }
      },
      
      leaveVariant: function(e) {
        const self = this;
        this.hoverTimeout = setTimeout(function() {
          const variant = $(e.target).closest('.product-card-variants').find('.active').parent().attr('name')
          
          if (variant === 'variant14' && self.showPriceRange === false) {
            self.showDiscountPrice = true;
            self.showNormalPrice = false;
          } else if (variant === 'variant15' && self.showPriceRange === false) {
            self.showDiscountPrice = false;
            self.showNormalPrice = true;
          } else {
            self.showDiscountPrice = false;
            self.showNormalPrice = false;
          }
        }, 10)
      },

      setWishList: function(e) {
        const targetClass = e.target.parentNode.parentNode.parentNode.className;
        if (targetClass === 'product-card-heart' || targetClass === 'product-card-heart-filled') {
          const target = e.target.closest(".product-card").getAttribute('name');
          if (target === 'product1') {
            this.productOneIsWishListed = !this.productOneIsWishListed;
          } else if (target === 'product2') {
            this.productTwoIsWishListed = !this.productTwoIsWishListed;
          } else if (target === 'product3') {
            this.productThreeIsWishListed = !this.productThreeIsWishListed;
          }
        }
      },
      
      setDropdownOptionOne: function(e) {
        this.dropdownOptionOne = e.target.getAttribute('value');
      },
      
      setDropdownOptionTwo: function(e) {
        this.dropdownOptionTwo =  e.target.getAttribute('value');
      },
      
      searchDropdownOption: function(e) {
        const input = this.searchInput;
        const options = $(e.target).closest('.dropdown-menu').find('.dropdown-options-container .dropdown-option')
        
        if (input.length > 0) {
          options.each(function() {
            $(this).show();
            const brand = $(this).text();
            const startMatchingIndex = brand.toLowerCase().indexOf(input.toLowerCase());
            
            if (startMatchingIndex !== -1) {
              const firstMatch = brand.slice(0, startMatchingIndex);
              const secondMatch = brand.slice(startMatchingIndex + input.length); 
              const inputMatch = brand.slice(startMatchingIndex, startMatchingIndex + input.length);
              
              $(this).find('.search-match').text(inputMatch);
              const searchMatchSpan = $(this).find('.search-match').get(0).outerHTML;
              
              $(this).html(firstMatch + searchMatchSpan + secondMatch);
            } else {
              $(this).hide();
            }
          });
        } else {
          options.each(function() {
            const brand = $(this).text();
            const match = $(this).find('.search-match').get(0).outerHTML;
            
            $(this).html(brand + match);
            $(this).find('.search-match').text('');
            
            $(this).show();
          })
        }
      }
    },

    created() {
      this.setProductRating();
    }
  });
